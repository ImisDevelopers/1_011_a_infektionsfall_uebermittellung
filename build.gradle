/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java project to get you started.
 * For more details take a look at the Java Quickstart chapter in the Gradle
 * User Manual available at https://docs.gradle.org/6.2.2/userguide/tutorial_java_projects.html
 */

// Build client and server files
task assemble {}

// Build artifacts
task build {}

// Copy frontend content to server resources
task processClientResources(type: ProcessResources) {
	from 'client/dist'
	into 'server/build/static'
}

// Run the backend (replaces :server:bootRun)
task run {}
// Run the frontend (replaces :client:serve)
task runFrontendDev {}

// Build a system Jar-File
task jar {}


// Need info of subproject configurations (aka the tasks defined therein)
evaluationDependsOn(":client")
evaluationDependsOn(":server")


// >>>>> DEPENDENCY MAPPINGS >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
tasks.processClientResources.dependsOn(':client:assemble')

tasks.assemble.dependsOn(':processClientResources')
tasks.jar.dependsOn('assemble', ':server:bootJar')
tasks.build.dependsOn('jar')

tasks.run.dependsOn('assemble', ':server:bootRun')
tasks.runFrontendDev.dependsOn(':client:serve')

project(':client') {
	tasks.generateClient.dependsOn(':server:buildSwaggerConfig')
}

project(':server') {
	tasks.bootRun.mustRunAfter(':assemble')
	tasks.bootJar.mustRunAfter(':assemble')
	tasks.jib.dependsOn('assemble')
}